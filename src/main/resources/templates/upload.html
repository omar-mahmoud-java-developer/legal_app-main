<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{../css/file.css}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Page</title>
    <!-- Add jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Add Select2 CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body>
    <div class="upload-form">
        <h2>Upload Files</h2>
        <form th:action="@{/request/create}" th:object="${reuqesrDto}" method="POST" enctype="multipart/form-data">
            <label for="fileUpload">Choose files:</label>
            <input type="file" id="fileUpload" th:field="*{files}" name="files" multiple required>
            <p th:if="${#fields.hasErrors('files')}" th:errorclass="text-danger" th:errors="*{files}"></p>

            <label for="fileDescription">File description:</label>
            <textarea id="fileDescription" th:field="*{description}" name="description" rows="4" placeholder="Enter a description for the files..." required></textarea>
            <p th:if="${#fields.hasErrors('description')}" th:errorclass="text-danger" th:errors="*{description}"></p>

            <label for="priorityLevel">Priority Level:</label>
            <select id="priorityLevel" th:field="*{priorityLevel}" required>
                <option th:each="level : ${T(com.omar.legal_app.dto.PriorityLevel).values()}"
                        th:value="${level}" th:text="${level}"></option>
            </select>

            <label for="cases">Case Type:</label>
            <select id="cases" th:field="*{cases}" required>
                <option th:each="case : ${T(com.omar.legal_app.dto.Cases).values()}"
                        th:value="${case}" th:text="${case}"></option>
            </select>

            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" th:field="*{startDate}" required>

            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" th:field="*{endDate}" required>

            <label for="customer">Select Customer:</label>
            <select id="customer" th:field="*{customerId}" class="select2" required></select>

            <button type="submit">Upload</button>
        </form>
    </div>

    <script>
        $(document).ready(function() {
            $('.select2').select2({
                placeholder: "Select a customer",
                allowClear: true,
                ajax: {
                    url: '/request/searchCustomers',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            query: params.term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: $.map(data, function (customer) {
                                return {
                                    id: customer.id,
                                    text: customer.name + ' - ' + customer.email 
                                };
                            })
                        };
                    },
                    cache: true
                }
            });
        });
    </script>
</body>
</html>
